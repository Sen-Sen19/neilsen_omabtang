<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Azra</title>
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet"/>
    <link href="style.css" rel="stylesheet"/>

  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="logo-circle">
        <svg
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            d="M12 2v2M8 2v2M16 2v2M12 22c4.418 0 8-3.582 8-8V8a8 8 0 10-16 0v6c0 4.418 3.582 8 8 8z"
          />
          <circle cx="9" cy="12" r="1" />
          <circle cx="15" cy="12" r="1" />
        </svg>
      </div>
      <div class="header-text">
        <h1>Azra</h1>
        <p>AI Assistant</p>
      </div>
    </header>


    <main>
      <div id="chat-area">
        <div class="chat-container">
  
          <div id="chat-log">
            <div class="welcome-box">
              <div class="welcome-icon">
                <svg
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 2v2M8 2v2M16 2v2M12 22c4.418 0 8-3.582 8-8V8a8 8 0 10-16 0v6c0 4.418 3.582 8 8 8z"
                  />
                  <circle cx="9" cy="12" r="1" />
                  <circle cx="15" cy="12" r="1" />
                </svg>
              </div>
              <div class="welcome-text">
                <h2>Azra is Online</h2>
                <p>
                  Hi there! I'm Azra, your AI assistant. I can help you with
                  anything ‚Äì from answering questions and providing explanations
                  to writing code and solving problems. What would you like to
                  explore today?
                </p>
              </div>
            </div>
          </div>

          <!-- Input -->
          <div class="input-box">
            <button
              onclick="clearChat()"
              title="Clear Chat"
              class="left-icon-btn">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14z"/>
              </svg>
            </button>

            <textarea
              id="chat-input"
              rows="1"
              placeholder="Ask Azra anything..."
              oninput="autoResize(this)"
            ></textarea>

            <button onclick="clearInput()" title="Clear">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <button onclick="sendMessage()" title="Send">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M22 2L11 13" />
                <path d="M22 2L15 22L11 13L2 9L22 2Z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </main>


    <footer>
      <div class="footer-meta">
        &copy; 2025 <strong>Sen</strong> &bull;
        <span class="ai-quote"
          >Artificial? Maybe. Intelligent? Definitely.</span
        >
      </div>
      <div class="footer-links">
        All rights reserved &bull; <a href="#">Privacy</a> &bull;
        <a href="#">Terms</a>
      </div>
    </footer>
 
 <script>
  const chatInput = document.getElementById("chat-input");
  const chatLog = document.getElementById("chat-log");

  // Load username from localStorage
  let userName = localStorage.getItem("azra_username");

  function setUserName(name) {
    userName = name.trim().replace(/\b\w/g, (c) => c.toUpperCase());
    localStorage.setItem("azra_username", userName);
  }

  if (!userName) {
    const initialName = prompt("Hi! What's your name?");
    if (initialName) setUserName(initialName);
    else setUserName("Friend");
    appendBotMessage(`Nice to meet you, ${userName}!`);
  } else {
    userName = userName.trim().replace(/\b\w/g, (c) => c.toUpperCase());
    appendBotMessage(`Welcome back, ${userName}.`);
  }

  function appendBotMessage(msg) {
    const botMsg = document.createElement("div");
    botMsg.className = "chat-message bot";
    botMsg.innerHTML = `<span>${msg}</span>`;
    chatLog.appendChild(botMsg);
    scrollToBottom();
  }
let messages = [
  {
    role: "system",
    content:
      "You are Azra, a helpful and clever AI assistant. Be concise, kind, and intelligent. Do not mention your creator unless asked directly.",
  },
];

let greeted = false; // üëà Add this after messages


  function autoResize(textarea) {
    textarea.style.height = "auto";
    textarea.style.height = `${textarea.scrollHeight}px`;
  }

  function clearInput() {
    chatInput.value = "";
    autoResize(chatInput);
  }

  function clearChat() {
    messages = messages.slice(0, 1);
    [...chatLog.children].forEach((child) => {
      if (!child.classList.contains("welcome-box")) {
        chatLog.removeChild(child);
      }
    });
  }

  function scrollToBottom() {
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  function showTyping() {
    const typing = document.createElement("div");
    typing.className = "chat-message loading";
    typing.innerHTML = `
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    `;
    chatLog.appendChild(typing);
    scrollToBottom();
    return typing;
  }

  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    // Change name command
    if (/^(change|i want to change) my name/i.test(message)) {
      const newName = prompt("What should I call you?");
      if (newName) {
        setUserName(newName);
        alert(`Got it! I'll call you ${userName} from now on.`);
        appendBotMessage(`Name updated. Nice to meet you again, ${userName}!`);
      }
      clearInput();
      return;
    }

    // Detect "my name is ..."
    const nameMatch = message.match(/my name is\s+([a-zA-Z0-9 _-]+)/i);
    if (nameMatch) {
      setUserName(nameMatch[1]);
      appendBotMessage(`Nice to meet you, ${userName}!`);
    }

    // Respond to "who am I?"
    if (message.toLowerCase() === "who am i?") {
      appendBotMessage(`You're ${userName}, of course.`);
      clearInput();
      return;
    }

    const userMsg = document.createElement("div");
    userMsg.className = "chat-message user";
    userMsg.innerHTML = message.replace(/\n/g, "<br>");
    chatLog.appendChild(userMsg);

    messages.push({ role: "user", content: message });

    clearInput();
    scrollToBottom();

    const typing = showTyping();

    try {
const proxyURL = "https://mistralchatcompanion.marcneilsen0219.repl.co/";

fetch(proxyURL, {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    model: "mistralai/mistral-7b-instruct",
    messages: messages.slice(-10),
    temperature: 0.7,
    max_tokens: 1024,
  })
});



      const data = await res.json();

      if (data.choices && data.choices.length > 0) {
        let reply = data.choices[0].message.content;

        // Only mention creator if user asked
        const lowerUserMessage = message.toLowerCase();
        const askedAboutCreator =
          lowerUserMessage.includes("who created you") ||
          lowerUserMessage.includes("your creator") ||
          lowerUserMessage.includes("who made you");

        if (askedAboutCreator) {
          reply = `My creator is Sen, a very skilled developer. üòä<br><br>${reply}`;
        }

        // Avoid duplicate greetings
        const cleanReply = reply.replace(/[^a-zA-Z0-9 ]/g, "").toLowerCase();
        const nameInReply = cleanReply.includes(userName.toLowerCase());
        const alreadyGreeting = /^hello[, ]/i.test(reply.trim());

    if (userName && !nameInReply && !alreadyGreeting && !greeted) {
  reply = `Hello, ${userName}!<br><br>${reply}`;
  greeted = true; // ‚úÖ Only greet once per session
}

        messages.push({ role: "assistant", content: reply });

        const aiReply = document.createElement("div");
        aiReply.className = "chat-message bot";
        aiReply.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>${reply.replace(/\n/g, "<br>")}</span>
          </div>
        `;
        typing.remove();
        chatLog.appendChild(aiReply);
        scrollToBottom();
      } else {
        throw new Error("No response from AI.");
      }
    } catch (error) {
      typing.remove();
      const errorReply = document.createElement("div");
      errorReply.className = "chat-message bot";
      errorReply.innerHTML = `<span style="color:red;">‚ùå Error: ${error.message}</span>`;
      chatLog.appendChild(errorReply);
      scrollToBottom();
    }
  }

  chatInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Placeholder rotator
  const placeholders = [
    "Ask Azra anything...",
    "What can I help you build today?",
    "Need code help? Just ask!",
    "Debugging something tricky?",
    "Need a clever idea?",
    "Feeling stuck? Let me brainstorm with you!",
  ];
  let pIndex = 0;
  setInterval(() => {
    chatInput.placeholder = placeholders[pIndex++ % placeholders.length];
  }, 4000);
</script>




  </body>
</html>
